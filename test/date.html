<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
	<title>Date.js Unit Tests</title>	
	<script src="../lib/prototype.js" type="text/javascript"></script>
  <script src="../lib/unittest.js" type="text/javascript"></script>	
	<script src="../src/date.js" type="text/javascript"></script>
	<link rel="stylesheet" href="test.css" type="text/css" media="all" />
</head>
<body>
  <div id="testlog"></div>
  <script type="text/javascript" language="javascript">
  // <![CDATA[
    Test.context("Date", {
      setup: function() { with(this) {
        this.date = Date.on(2007, 8, 28);        
      }}, 
      
      "should be equal to its clone": function() { with(this) {
        var copy = this.date.clone();
        copy.equals(this.date).shouldEqual(true);
      }},
      
      "should have time equal to its clone": function() { with(this) {
        var copy = this.date.clone();
        copy.getTime().shouldEqual(this.date.getTime());
      }},
      
      "should set noon without minutes on the hour": function() { with(this) {
        var noon = this.date.atNoon();
        noon.getFullYear().shouldEqual(this.date.getFullYear());
        noon.getMonth().shouldEqual(this.date.getMonth());
        noon.getDate().shouldEqual(this.date.getDate());
        noon.getHours().shouldEqual(12);
        
        noon.getMinutes().shouldEqual(0);
        noon.getSeconds().shouldEqual(0);
        noon.getMilliseconds().shouldEqual(0);
      }},
      
      "should set beginning of day to zero hour": function() { with(this) {
        var today = this.date.atBeginningOfDay();        
        today.getFullYear().shouldEqual(this.date.getFullYear());
        today.getMonth().shouldEqual(this.date.getMonth());
        today.getDate().shouldEqual(this.date.getDate());        
        today.getHours().shouldEqual(0);
        today.getMinutes().shouldEqual(0);
        today.getSeconds().shouldEqual(0);        
        today.getMilliseconds().shouldEqual(0);        
      }},
      
      "at beginning of day should equal today": function() { with(this) {
        var this_morning = new Date().atBeginningOfDay();
        this_morning.equals(Date.today()).shouldEqual(true);        
      }},
      
      "comes before a later date": function() { with(this) {
        var copy = this.date.clone();
        copy.setMilliseconds(this.date.getMilliseconds() + 1);
        this.date.before(copy).shouldEqual(true);
      }},
      
      "comes after an earlier date": function() { with(this) {
        var copy = this.date.clone();
        copy.setMilliseconds(this.date.getMilliseconds() - 1);
        this.date.after(copy).shouldEqual(true);
      }},
      
      "comes on or before a later date": function() { with(this) {
        var copy = this.date.clone();
        copy.setMilliseconds(this.date.getMilliseconds() + 1);
        this.date.onOrBefore(copy).shouldEqual(true);
      }},
      
      "comes on or after an earlier date": function() { with(this) {
        var copy = this.date.clone();
        copy.setMilliseconds(this.date.getMilliseconds() - 1);
        this.date.onOrAfter(copy).shouldEqual(true);
      }},
      
      "comes on or before an identical date": function() { with(this) {
        var copy = this.date.clone();
        copy.onOrBefore(this.date).shouldEqual(true);
      }},
      
      "comes on or after an identical date": function() { with(this) {
        var copy = this.date.clone();
        copy.onOrAfter(this.date).shouldEqual(true);
      }},            
      
      "should support adding years": function() { with(this) {
        var today = this.date.atNoon();        
        var nextYear = Date.on(
          today.getFullYear() + 1, 
          today.getMonth(),
          today.getDate()).atNoon();
        today.addYears(1).equals(nextYear).shouldEqual(true);          
      }},
      
      "should support subtracting years": function() { with(this) {
        var today = this.date.atNoon();        
        var lastYear = Date.on(
          today.getFullYear() - 1, 
          today.getMonth(),
          today.getDate()).atNoon();
        today.subtractYears(1).equals(lastYear).shouldEqual(true);          
      }},
      
      "should not change when adding and subtracting same duration":
      function() { with(this) {
        this.date.addYears(15).subtractYears(15).
          equals(this.date).shouldEqual(true);
      }},
      
      "should know 2007 is not a leap year": function() { with(this) {
        this.date.leapYear().shouldEqual(false);
      }},
      
      "should know 2008 is a leap year": function() { with(this) {
        Date.on(2008, 1, 1).leapYear().shouldEqual(true);
      }},
      
      "should know 2200 is not leap year": function() { with(this) {
        Date.on(2200, 1, 1).leapYear().shouldEqual(false);
      }},
      
      "should know 2010 is not leap year": function() { with(this) {
        Date.on(2010, 1, 1).leapYear().shouldEqual(false);
      }},
      
      "should know 2400 is a leap year": function() { with(this) {
        Date.on(2400, 1, 1).leapYear().shouldEqual(true);
      }},
      
      "add 1 day to Dec 31 should change years": function() { with(this) {
        var new_years_eve = Date.on(2007, 12, 31);
        var new_years_day = new_years_eve.addDays(1);
        new_years_eve.before(new_years_day).shouldEqual(true);
        new_years_day.getFullYear().shouldEqual(2008);
        new_years_day.getMonth().shouldEqual(1);
        new_years_day.getDate().shouldEqual(1);
        new_years_day.equals(Date.on(2008, 1, 1)).shouldEqual(true);
      }},
      
      "minus 1 day from Jan 1 should change years": function() { with(this) {
        var new_years_day = Date.on(2008, 1, 1);
        var new_years_eve = new_years_day.subtractDays(1);
        new_years_eve.before(new_years_day).shouldEqual(true);
        new_years_eve.getFullYear().shouldEqual(2007);
        new_years_eve.getMonth().shouldEqual(12);
        new_years_eve.getDate().shouldEqual(31);
        new_years_eve.equals(Date.on(2007, 12, 31)).shouldEqual(true);
      }},
      
      "add 1 day to Feb 28 in leap year should be Feb 29": 
      function() { with(this) {
        var leap = Date.on(2008, 2, 28);
        var next = leap.addDays(1);
        next.getFullYear().shouldEqual(2008);
        next.getMonth().shouldEqual(2);
        next.getDate().shouldEqual(29);
      }},
      
      "add 1 day to Feb 28 in non leap year should be Mar 1": 
      function() { with(this) {
        var start = Date.on(2010, 2, 28);
        var next = start.addDays(1);
        next.getFullYear().shouldEqual(2010);        
        next.getMonth().shouldEqual(3);
        next.getDate().shouldEqual(1);
      }},
      
      "next year should be 1 year from today at beginning of day": 
      function() { with(this) {
        var today = new Date().atBeginningOfDay();
        var nextYear = Date.nextYear();
        today.addYears(1).equals(nextYear).shouldEqual(true);
      }},
      
      "last year should be 1 year ago today at beginning of day": 
      function() { with(this) {
        var today = new Date().atBeginningOfDay();
        var lastYear = Date.lastYear();
        today.subtractYears(1).equals(lastYear).shouldEqual(true);
      }}
    });
  // ]]>
  </script>
</body>
</html>